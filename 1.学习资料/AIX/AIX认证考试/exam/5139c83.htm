<!-- output file generated by BM Utilities -->
<html>
<head>
<title>
IBM Certification Study Guide  AIX V4.3 System Support
</title>
</head>
<body bgcolor=#f0f0f0><a name="htmltop"></a>
<p><a href="./5139fm.htm#tockupH12"><img src="f2htoc.gif"></a>
<a href="./5139indx.htm"><img src="f2hindex.gif"></a>
<a href="5139c83.htm#htmlbot"><img src="f2hbot.gif"></a>
<a href="5139c82.htm#htmlbot"><img src="f2hprev.gif">8.2.4  User Data</a><br>

<h2><a name="kupH13">8.3  Verifying System Backups</a>
</h2>

<p><a name=index862>The</a> only method to verify that the system backup will
correctly restore with no problems is to actually restore all the files listed
in the company's Disaster Recovery Plan. However, in order to minimize problems
due to tape media damage, there are a number of ways you can verify whether
your backup has been done properly or not:
<ul>
<li>Using SMIT
<p><li>Using the <tt>restore</tt> command
</ul>

<p><table border=2 bgcolor=#f0f0f0  width=100%><tr><th align=left>Note</th><tr><td>
<p>The only way to verify that the <tt>mksysb</tt> tape will successfully boot
is to bring the machine down and boot from the tape. No data needs to be
restored. Data verification can be done using the preceding techniques.
<p>However, caution must be taken if the PROMPT field in the bosinst.data file
is set to NO, which will cause the system to begin a <tt>mksysb</tt> restore
automatically.
</td></tr></table>

<h3><a name="16100">8.3.1  Using SMIT to Verify a Tape</a>
</h3>

<p>Generally, <tt>mksysb</tt> is an unattended activity, therefore you need to
look for errors that might have occurred during the save operation and will
render data unavailable once you try to restore it. It is always a good
practice to look at your smit.log file after a <tt>mksysb</tt> is run from
SMIT. It is recommended that you do not run <tt>mksysb</tt> directly from the
command line in order to ensure that you do not miss errors generated during a
save operation.
<p>In order to verify the <tt>mksysb</tt> tape use the SMIT fast path:
<p><tt>smitty lsmksysb</tt>
<p><a name=index866>A</a> screen similar to <a href="#15775">Figure 101</a>
will be shown.
<br><br><a name=15775>
<br>
<img src="kupi55.gif"></a>
<br><i>Figure 101: List mksysb Tape Contents</i><br><br>
<ol>
<li>Select your backup device name.
<p><li>Select defaults for all other parameters and press <b>Enter=DO</b>. This
will list the contents of your <tt>mksysb</tt> tape and log them in the
smit.log as shown below:
<pre>
New volume on /dev/rmt0.1:
Cluster size is 51200 bytes (100 blocks).
The volume number is 1.
The backup date is: Tue Nov 10 17:02:28 CST 1998
Files are backed up by name.
The user is root.
./bosinst.data
./image.data
./tmp/vgdata/rootvg/copied.map
./tmp/vgdata/rootvg/fslv00.map
./tmp/vgdata/rootvg/hd1.map
./tmp/vgdata/rootvg/hd2.map
...
</pre>
<p>Cross check the listing and verify that none of your important files are
missing. This will ensure that data will be available to you once you need it.
The listing that is generated as a result of executing this command is helpful
in finding out the date this tape was generated, which might help you if you do
a <tt>mksysb</tt> on a regular basis and do not rotate tapes. If your tape tags
are accidently destroyed you can still find out the latest backup you have by
using this method.
</ol>

<h3><a name="kupH16">8.3.2  Using Restore to Verify a Tape</a>
</h3>

<p><a name=index872>In</a> order to verify a <tt>mksysb</tt> tape without using
SMIT, you need to use the <tt>restore</tt> command since all the files with
<tt>mksysb</tt> are backed up in backup file format using <tt>backup</tt>
command.
<p>Data on a <tt>mksysb</tt> tape is written from the fourth file marker
onwards (see section <a href="5139c82.htm#11222">8.2  The Data Layout of a
mksysb Tape</a> for details on <tt>mksysb</tt> tape format), therefore you need
to control the tape manually to move to the correct segment of the tape. Use
the <tt>tctl </tt>command to control the tape. The general syntax of the
<tt>tctl</tt> command is as follows:
<pre>
tctl [ -f Device ] [ eof | weof | fsf | bsf | fsr | bsr | rewind | offline | rewoffl | erase | retension | reset | status ] [ Count ]
</pre>
<p>The <tt>tctl</tt> <a name=index875>command</a> gives subcommands to a
streaming tape device. Subcommands most frequently used by <tt>tctl</tt> are
listed in <a href="#34644">Table 14</a>. <br><br>
<a name=34644> <img src=kupt62.gif></a><br>
<i>Table 14: tctl Subcommands</i><br><br>
<p>To see the contents of the <tt>mksysb</tt> tape use the following sequence
of commands:
<ol>
<li>Rewind the tape using the command:
<pre>
tctl -f /dev/rmtxx rewind
</pre>
<p><li>Move to the fourth file marker, read the contents of the tape and
redirect the output to a file using the command:
<pre>
restore -s4 -Tvqf /dev/rmtxx.1 &gt; /tmp/mksysb.log
</pre>
</ol>
<p>This will generate a listing similar to the smit.log output shown in section
<a href="#16100">8.3.1  Using SMIT to Verify a Tape</a>.

<p><table border=2 bgcolor=#f0f0f0  width=100%><tr><th align=left>Note</th><tr><td>
<p>You may encounter an error similar to:
<pre>
0511-160 Cannot read backup media
/dev/rmtx.1 There is an input or output error.
</pre>
<p>If <a name=index880>this</a> happens, your tape block size has changed since
your last backup, use the following command to reset the block size:
<pre>
chdev -l rmtxx -a block_size=0
</pre>
</td></tr></table>
<a name="htmlbot"></a>
<p><a href="./5139fm.htm#tockupH13"><img src="f2htoc.gif"></a>
<a href="./5139indx.htm"><img src="f2hindex.gif"></a>
<a href="5139c83.htm#htmltop"><img src="f2htop.gif"></a>
<a href="5139c84.htm#htmltop"><img src="f2hnext.gif">8.4  Saving User
Data</a><br>
</body>
</html>

