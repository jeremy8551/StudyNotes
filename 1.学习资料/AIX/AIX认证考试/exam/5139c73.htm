<!-- output file generated by BM Utilities -->
<html>
<head>
<title>
IBM Certification Study Guide  AIX V4.3 System Support
</title>
</head>
<body bgcolor=#f0f0f0><a name="htmltop"></a>
<p><a href="./5139fm.htm#toc9pdH15"><img src="f2htoc.gif"></a>
<a href="./5139indx.htm"><img src="f2hindex.gif"></a>
<a href="5139c73.htm#htmlbot"><img src="f2hbot.gif"></a>
<a href="5139c72.htm#htmlbot"><img src="f2hprev.gif">7.2.1.8  Log Maintenance
Activities</a><br>

<h2><a name="9pdH16">7.3  System Dump Facility</a>
</h2>

<p><a name=index758>The</a> system dump copies selected kernel structures to
the dump device when an unexpected system halt occurs. The dump device can be
configured dynamically to either a tape or a logical volume on the hard disk to
store the system dump. A primary dump device is a dedicated dump device, while
a secondary dump device is shared.
<p>While installing an operating system, the dump device is automatically
configured. By default, AIX Version 4 configures /dev/hd6 (paging logical
volume) as the primary dump device and /dev/sysdumpnull as the secondary dump
device. If the system was migrated from AIX Version 3, /dev/hd7 (the default
dump device for AIX Version 3) will continue to be the default dump device for
AIX Version 4.
<p>The dump can either be system initiated or user initiated, as shown in
<a href="#29542">Figure 95</a>. When the system dump completes, the system
either halts or reboots, depending upon the setting of the autorestart
attribute of sys0, which can be shown and altered using SMIT by selecting
<b>System Environments</b>, and then <b>Change / Show Characteristics of
Operating System</b>. The Automatically REBOOT system after a crash option
shows and sets the value of sys0 attribute.
<br><br><a name=29542>
<br>
<img src="9pdf3.gif"></a>
<br><i>Figure 95: Successful System Dumps - LED Codes</i><br><br>

<h3><a name="9pdH18">7.3.1  Managing a Dump Device</a>
</h3>

<p><tt>The sysdumpdev</tt> command is used to dynamically configure the dump
device as shown in the following examples.
<ul>
<li>To list the current dump destination use the following command:
<pre>
<b># sysdumpdev -l</b>
primary              /dev/hd6
secondary            /dev/sysdumpnull
copy directory       /var/adm/ras
forced copy flag     TRUE
always allow dump    FALSE
</pre>
<p><li>The following example shows the command to change
<a name=index761>the</a> primary dump device from the default, /dev/hd6, to
/dev/hd5:
<pre>
<b># sysdumpdev -P -p /dev/hd5</b>
primary              /dev/hd5
secondary            /dev/sysdumpnull
copy directory       /var/adm/ras
forced copy flag     TRUE
always allow dump    FALSE
</pre>
<p><li>To estimate the dump size of the current system, use the following
command:
<pre>
<b># sysdumpdev -e</b>
0453-041 Estimated dump size in bytes: 18227200
</pre>
<p><li>The following example shows the command to display statistical
<a name=index774>information</a> about the previous dump, and in this example,
there is no dump record:
<pre>
<b># sysdumpdev -L</b>
0453-019 No previous dumps recorded.
</pre>
<p><li>The following example shows running the <tt>sysdumpdev -L</tt> command
after a successful dump has occurred on the system:
<pre>
<b># sysdumpdev -L</b>
0453-039

Device name:         /dev/hd6
Major device number: 10
Minor device number: 2
Size:                24202752 bytes
Date/Time:           Tue Nov 10 16:50:45 CST 1998
Dump status:         0
dump completed successfully
Dump copy filename: /var/adm/ras/vmcore.1
</pre>
<p>Alternatively, all the commands used in the preceding examples of this
section can be executed using the SMIT fastpath command by executing <tt>smit
dump, </tt>which will display the menu shown in <a href="#31745">Figure 96</a>.
Then select the appropriate option from the menu to do the desired function.
<br><br><a name=31745>
<br>
<img src="9pdi16.gif"></a>
<br><i>Figure 96: SMIT Dump Command</i><br><br>
</ul>

<h3><a name="9pdH20">7.3.2  System Initiated Dump</a>
</h3>

<p>A system dump initiated by a kernel panic is written to the primary dump
device.

<h4><a name="9pdH21">7.3.2.1  Understanding Flashing 888 Error Messages</a>
</h4>

<p><a name=index776>A</a> flashing 888 in a three digit hardware display
indicates that a message is encoded as a string of three digit display values
which can be read by pressing the reset button repeatedly and noting the
changed three digit value every time until a flashing 888 is displayed again.
Some RS/6000 systems use an advance button to perform this task.
<p>An initial value of 102 after flashing 888 indicates an unexpected system
halt as shown in <a href="#39726">Figure 97</a>. The value of mmm indicates the
cause of halt, crash code (see <a href="#16020">Table 12</a>), and the value of
ddd indicates the dump status, and dump code (see
<a href="#29626">Table 13</a>).
<br><br><a name=39726>
<br>
<img src="9pdf1.gif"></a>
<br><i>Figure 97: Unexpected System Halt - Three-Digit Display
String</i><br><br>
<p>The following table lists various crash <a name=index780>codes.</a> The 2xx
type codes describe a machine check are reporting hardware failure. <br><br>
<a name=16020> <img src=9pdt22.gif></a><br>
<i>Table 12: Crash Codes</i><br><br>
<p>The following table lists various system dump codes. <br><br>
<a name=29626> <img src=9pdt23.gif></a><br>
<i>Table 13: System Dump Codes</i><br><br>

<h3><a name="9pdH25">7.3.3  User Initiated Dump</a>
</h3>

<p>There are three ways for a user to invoke a system dump depending upon the
system condition as shown in <a href="#22531">Figure 98</a>. The following
sections discuss the steps involved in initiating a system dump, verifying the
dump, copying the dump onto a tape, and sending it to Service Support Center
for analysis.

<h4><a name="9pdH26">7.3.3.1  Check the Estimated Dump Size</a>
</h4>

<p><a name=index784>The</a> following command shows the estimated size of dump
will be <tt>20971520</tt> bytes:
<pre>
<b># sysdumpdev -e</b>
0453-041 Estimated dump size in bytes: 20971520
</pre>

<h4><a name="9pdH27">7.3.3.2  Check the Size of Primary Dump Device</a>
</h4>

<p>The primary dump device, in this case, is the paging logical volume
(/dev/hd6). To display its size, use <tt>lsps -a</tt> command as shown in the
following example. If the reported free space is less than estimated dump size
(reported in the preceding section), you should increase the dump device size.
The following example shows the 128 MB of primary dump device with 6% used:
<pre><font size="-1">
<b># lsps -a</b>
Page Space  Physical Volume   Volume Group    Size   %Used  Active  Auto  Type
hd6         hdisk0            rootvg         128MB       6     yes   yes    lv
</font>
</pre>

<h4><a name="9pdH28">7.3.3.3  Starting a Dump</a>
</h4>

<p><a name=index786>If</a> you initiate the system dump from the command line,
use the <tt>sysdumpstart</tt> command with a -p flag to write to the primary
device or a -s flag to write to the secondary device.
<p>If the dump is initiated using the special key sequences, use the sequence
Ctrl-Alt-NumPad1 to write to the primary dump device and use the sequence
Ctrl-Alt-NumPad2 to write to the secondary dump device.
<p>If you initiate a system dump by pressing the reset button, the system dump
is written to the primary dump device.
<br><br><a name=22531>
<br>
 <br>
<img src="9pdf6.gif"></a>
<br><i>Figure 98: Method of User Initiated System Dump</i><br><br>

<h4><a name="9pdH30">7.3.3.4  Verifying a System Dump</a>
</h4>

<p><a name=index788>The</a> <tt>crash</tt> <a name=index791>command</a> is an
interactive tool which is used to examine a system dump file. Checking that the
dump is readable saves time by reducing callbacks from the support center.
<p>To invoke the <tt>crash</tt> command on a system image file and kernel file,
use the following command syntax:
<pre>
crash SystemImageFile KernelFile
</pre>
<p>where SystemImageFile is either a file name or the name of the dump device
and KernelFile is the default kernel /usr/lib/boot/unix.
<p>The following example shows the commands to obtain the system dump file name
(var/adm/ras/vmcore.1) and then uses the <tt>crash</tt> command on that dump
file to verify the validity of dump.
<pre>
<b># sysdumpdev -L</b>
0453-039

Device name:         /dev/hd6
Major device number: 10
Minor device number: 2
Size:                24202752 bytes
Date/Time:           Tue Nov 10 16:50:45 CST 1998
Dump status:         0
dump completed successfully
Dump copy filename: /var/adm/ras/vmcore.1
#
<b># crash /var/adm/ras/vmcore.1</b>
Using /unix as the default namelist file.
&gt;
<b>&gt; stat</b>
        sysname: AIX
        nodename: aix4xdev
        release: 3
        version: 4
        machine: 000044091C00
        time of crash: Tue Nov 10 16:50:45 CST 1998
        age of system: 1 day, 5 hr., 28 min.
        xmalloc debug: disabled
        abend code: 0
        csa: 0x0
&gt;
<b>&gt; quit</b>
#
</pre>
<p>If the <tt>crash</tt> command outputs the &gt;, and the <tt>stat
</tt>subcommand verifies the details of dump, the dump is successful. Any other
output indicates the dump may not be successfully analyzed.

<h4><a name="9pdH31">7.3.3.5  Compile and Copy a System Dump onto Tape</a>
</h4>

<p><a name=index797>The</a> <tt>snap</tt> command is used to gather
configuration information of the system. It provides a convenient method of
sending the lslpp and errpt output to the Service Support Center. It gathers
the information and compresses the information to a tar file which can be
downloaded to a tape or diskette or electronically transmitted.
<p>The default directory for the output from the <tt>snap</tt>
<a name=index800>command</a> is /tmp/ibmsupt. If you want to name an optional
directory, use the -d option with the path of the desired output directory.
Approximately 8 MB of temporary disk space is required when executing all of
the <tt>snap</tt> command options. The cleanup option -r, should be used to
remove the information saved by the <tt>snap</tt> command and to retrieve disk
space.
<p>Following are the commonly used options with <tt>snap</tt> command:
<dl>
<dt>
<b>-g</b> <tt></tt>
<dd>Gathers the output of the <tt>lslpp -L</tt> command and stores the
information in /tmp/ibmsupt/general/lslpp.L. The <tt>-g</tt> flag also gathers
general system information and outputs it to /tmp/ibmsupt/general/general.snap.
<dt>
<b>-D</b>
<dd>Gathers dump and /unix (assumes dump device to be /dev/hd7).
<dt>
<b>-a</b> <tt></tt>
<dd>Gathers information for all of the groups.
<dt>
<b>-c</b> <tt></tt>
<dd>Creates a compressed tar image of all files in the /tmp/ibmsupt directory
tree (or other output directory).
<dt>
<b>-o</b> <tt></tt>
<dd>Creates a tar file and downloads it to removable media.
<dt>
<b>-v</b>
<dd>Displays the output of the commands executed by the snap command.
<dt>
<b>-f</b>
<dd>Gather file system information.
<dt>
<b>-k</b>
<dd>Gather kernel information.
</dl>
<p>The following command copies the information on to tape device, rmt0:
<p><tt>/usr/sbin/snap -gfkD -o /dev/rmt0</tt>
<p>Before executing the <tt>snap -c</tt> or <tt>snap -o</tt> commands, any
additional information required by the Support Center should be copied to the
/tmp/ibmsupt directory. For example, you may be asked by the Service Support
Center to provide a test case that demonstrates the problem. The test case
should be copied to the /tmp/ibmsupt directory. When the -c or -o option of the
<tt>snap </tt>command is executed, the test case will be included.

<p><table border=2 bgcolor=#f0f0f0  width=100%><tr><th align=left>Note</th><tr><td>
<p>The <tt>snap -c</tt> and <tt>snap -o</tt> commands are mutually exclusive.
Do not execute both during the same problem-determination session. The <tt>snap
-c</tt> command should be used to transmit information electronically and the
<tt>snap -o</tt> command should be used to transmit information on a removable
output device.
</td></tr></table>

<h4><a name="9pdH32">7.3.3.6  Label the Dump Tape</a>
</h4>

<p><a name=index804>You</a> can label the dump tape with the following
information.
<ul>
<li>PMR number
<p><li>Command used to create the tape
<p><li>Block size of tape
</ul>
<a name="htmlbot"></a>
<p><a href="./5139fm.htm#toc9pdH16"><img src="f2htoc.gif"></a>
<a href="./5139indx.htm"><img src="f2hindex.gif"></a>
<a href="5139c73.htm#htmltop"><img src="f2htop.gif"></a>
<a href="5139c74.htm#htmltop"><img src="f2hnext.gif">7.4  References</a><br>
</body>
</html>

